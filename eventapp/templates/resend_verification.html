{% extends 'base.html' %}
{% block title %}Resend Verification - EventApp{% endblock %}
{% block content %}
  <div class="welcome-section">
    <h1 class="welcome-title">Resend Verification Email</h1>
    <p class="welcome-subtitle">Enter your email to receive a new verification link</p>
  </div>
  
  <form method="post" id="resendForm">
    <div class="form-group">
      <label for="email">Email address</label>
      <input type="email" class="form-control" id="email" name="email" required>
    </div>
    <button type="submit" class="btn btn-primary" id="resendBtn">Send Verification Email</button>
    <div id="timerDisplay" class="mt-2" style="display: none;">
      <small class="text-muted">Please wait <span id="countdown">60</span> seconds before requesting another email.</small>
    </div>
  </form>
  
  <div class="mt-4">
    <div class="alert alert-info">
      <h6><i class="fas fa-info-circle"></i> Important Information:</h6>
      <ul class="mb-0">
        <li>Check your email inbox and spam/junk folder for the verification link</li>
        <li>Verification links expire after 24 hours</li>
        <li>If you don't receive the email after 8 hours, please contact the administrator for assistance with account creation</li>
      </ul>
    </div>
  </div>
  
  <div class="mt-3 text-center">
    <p>Already verified? <a href="{{ url_for('login') }}">Log in here</a></p>
  </div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('resendForm');
    const button = document.getElementById('resendBtn');
    const timerDisplay = document.getElementById('timerDisplay');
    const countdown = document.getElementById('countdown');
    
    // Check if we should show timer (if form was just submitted)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('sent') === 'true') {
        startTimer();
    }
    
    function startTimer() {
        let timeLeft = 60; // 1 minute
        button.disabled = true;
        timerDisplay.style.display = 'block';
        
        const timer = setInterval(function() {
            countdown.textContent = timeLeft;
            timeLeft--;
            
            if (timeLeft < 0) {
                clearInterval(timer);
                button.disabled = false;
                timerDisplay.style.display = 'none';
                button.textContent = 'Send Verification Email';
            }
        }, 1000);
    }
    
    form.addEventListener('submit', function(e) {
        if (!button.disabled) {
            button.textContent = 'Sending...';
            button.disabled = true;
            
            // Add sent parameter to URL to trigger timer on page reload
            const formData = new FormData(form);
            const email = formData.get('email');
            
            // Let the form submit normally, but we'll handle the timer on the response
            setTimeout(function() {
                if (window.location.href.indexOf('sent=true') === -1) {
                    window.location.href = window.location.href + '?sent=true';
                }
            }, 100);
        }
    });
});
</script>
{% endblock %}
