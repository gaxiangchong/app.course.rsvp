{% extends 'base.html' %}
{% block title %}{{ get_translation('profile') }} - Noble Quest{% endblock %}
{% block content %}
  <div class="welcome-section">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="welcome-title">{{ get_translation('profile') }}</h1>
        <p class="welcome-subtitle">Manage your account settings</p>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-8">
      <form method="post">
        <!-- Personal Information Section -->
        <div class="form-section">
          <h5><i class="fas fa-user mr-2"></i>Personal Information</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="first_name">{{ get_translation('First Name') }}</label>
                <input type="text" class="form-control" id="first_name" name="first_name" value="{{ current_user.first_name or '' }}" placeholder="Enter your first name">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="last_name">{{ get_translation('Last Name') }}</label>
                <input type="text" class="form-control" id="last_name" name="last_name" value="{{ current_user.last_name or '' }}" placeholder="Enter your last name">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="username">{{ get_translation('user name') }}</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ current_user.username }}" required placeholder="Choose a unique username">
          </div>
          
          <div class="form-group">
            <label for="email">{{ get_translation('email') }}</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ current_user.email }}" required placeholder="your.email@example.com">
          </div>
          
          <div class="form-group">
            <label for="phone">{{ get_translation('phone_number') }}</label>
            <input type="tel" class="form-control" id="phone" name="phone" value="{{ current_user.phone or '' }}" placeholder="{{ get_currency_info(default_country).phone_placeholder }}">
          </div>
        </div>
        
        <!-- Location Information Section -->
        <div class="form-section">
          <h5><i class="fas fa-map-marker-alt mr-2"></i>{{ get_translation('Location') }}</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="country">{{ get_translation('Country') }}</label>
                <select class="form-control" id="country" name="country" onchange="updateCurrencyAndPlaceholders()">
                  <option value="Singapore" {% if current_user.country == 'Singapore' or not current_user.country or current_user.country == '' %}selected{% endif %}>Singapore</option>
                  <option value="Malaysia" {% if current_user.country == 'Malaysia' %}selected{% endif %}>Malaysia</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" class="form-control" id="city" name="city" value="{{ current_user.city or '' }}" placeholder="Singapore">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Notification Preferences Section -->
        <div class="form-section">
          <h5><i class="fas fa-bell mr-2"></i>Notification Preferences</h5>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="email_notifications" name="email_notifications" {% if current_user.email_notifications %}checked{% endif %}>
            <label class="form-check-label" for="email_notifications">
              <strong>Email Notifications</strong>
              <small class="d-block text-muted">Receive event updates and reminders via email</small>
            </label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="push_notifications" name="push_notifications" {% if current_user.push_notifications %}checked{% endif %}>
            <label class="form-check-label" for="push_notifications">
              <strong>Push Notifications</strong>
              <small class="d-block text-muted">Get instant notifications on your device</small>
            </label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="time_format_24h" name="time_format_24h" {% if current_user.time_format_24h %}checked{% endif %}>
            <label class="form-check-label" for="time_format_24h">
              <strong>24-Hour Time Format</strong>
              <small class="d-block text-muted">Use 24-hour format instead of 12-hour (AM/PM)</small>
            </label>
          </div>
        </div>
        
        <!-- Privacy Settings Section -->
        <div class="form-section">
          <h5><i class="fas fa-shield-alt mr-2"></i>Privacy Settings</h5>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="privacy_show_city" name="privacy_show_city" {% if current_user.privacy_show_city %}checked{% endif %}>
            <label class="form-check-label" for="privacy_show_city">
              <strong>Show My City</strong>
              <small class="d-block text-muted">Allow other users to see your city location</small>
            </label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="privacy_show_full_name" name="privacy_show_full_name" {% if current_user.privacy_show_full_name %}checked{% endif %}>
            <label class="form-check-label" for="privacy_show_full_name">
              <strong>Show My Full Name</strong>
              <small class="d-block text-muted">Display your complete name to other users</small>
            </label>
          </div>
        </div>
        
        <div class="text-center">
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-save mr-2"></i>Update Profile
          </button>
        </div>
      </form>
    </div>
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h5>Account Information</h5>
        </div>
        <div class="card-body">
          <p><strong>Member since:</strong> {{ current_user.created_at.strftime('%B %d, %Y') }}</p>
          <p><strong>Account type:</strong> {% if current_user.is_admin %}Organizer{% else %}Attendee{% endif %}</p>
          <p><strong>Membership Grade:</strong> 
            <span class="membership-grade" style="color: {{ get_membership_grade_info(current_user.membership_grade).color }};">
              <i class="{{ get_membership_grade_info(current_user.membership_grade).icon }}"></i>
              {{ current_user.membership_grade }}
            </span>
          </p>
          <p><strong>Available Credits:</strong> <span class="badge badge-warning"><i class="fas fa-coins"></i> {{ "%.2f"|format(current_user.credit_point or 0) }}</span></p>
          <p><strong>Total RSVPs:</strong> {{ current_user.rsvps|length }}</p>
          {% if current_user.is_admin %}
            <p><strong>Events created:</strong> {{ current_user.events|length }}</p>
          {% endif %}
          <p><strong>Display name:</strong> {{ current_user.display_name }}</p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
function updateCurrencyAndPlaceholders() {
    const countrySelect = document.getElementById('country');
    const cityInput = document.getElementById('city');
    const phoneInput = document.getElementById('phone');
    const selectedCountry = countrySelect.value;
    
    // Update city placeholder based on country
    if (selectedCountry === 'Singapore') {
        cityInput.placeholder = 'Singapore';
        phoneInput.placeholder = '+65 9123 4567';
    } else if (selectedCountry === 'Malaysia') {
        cityInput.placeholder = 'Kuala Lumpur';
        phoneInput.placeholder = '+60 12-345 6789';
    }
    
    // Currency info removed as requested
}

function getCurrencyInfo(country) {
    const currencies = {
        'Singapore': {
            code: 'SGD',
            symbol: 'S$',
            name: 'Singapore Dollar',
            phone_prefix: '+65',
            phone_placeholder: '+65 9123 4567'
        },
        'Malaysia': {
            code: 'MYR',
            symbol: 'RM',
            name: 'Malaysian Ringgit',
            phone_prefix: '+60',
            phone_placeholder: '+60 12-345 6789'
        }
    };
    return currencies[country] || currencies['Singapore'];
}

// Currency info display function removed as requested

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Ensure Singapore is selected by default if no country is set
    const countrySelect = document.getElementById('country');
    if (!countrySelect.value || countrySelect.value === '') {
        countrySelect.value = 'Singapore';
    }
    updateCurrencyAndPlaceholders();
});
</script>
{% endblock %}
