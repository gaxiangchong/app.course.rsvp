{% extends 'base.html' %}
{% block title %}Update Event - Noble Quest{% endblock %}
{% block content %}
  <div class="welcome-section">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="welcome-title">Update Event</h1>
        <p class="welcome-subtitle">Edit event details</p>
      </div>
      <div>
        <button type="button" class="btn btn-danger mr-2" data-toggle="modal" data-target="#cancelEventModal">
          <i class="fas fa-times mr-2"></i>Cancel Event
        </button>
        <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-secondary">
          <i class="fas fa-arrow-left mr-2"></i>Back to Event
        </a>
      </div>
    </div>
  </div>
  <form method="post" enctype="multipart/form-data">
    <div class="form-group">
      <label for="name">Event Name</label>
      <input type="text" class="form-control" id="name" name="name" value="{{ event.name }}" required placeholder="Enter event name">
    </div>
    <div class="form-group">
      <label for="description">Description / Objective</label>
      <textarea class="form-control" id="description" name="description" rows="3" placeholder="Describe your event...">{{ event.description }}</textarea>
    </div>
    
    <!-- Current Event Image -->
    {% if event.cover_image_url %}
    <div class="form-group">
      <label>Current Cover Image</label>
      <div class="current-image-preview">
        <img src="{{ event.cover_image_url }}" alt="Current cover image" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
      </div>
    </div>
    {% endif %}
    
    <!-- Event Image Upload -->
    <div class="form-group">
      <label for="cover_image">{% if event.cover_image_url %}Update Cover Image{% else %}Event Cover Image{% endif %}</label>
      <div class="custom-file">
        <input type="file" class="custom-file-input" id="cover_image" name="cover_image" accept="image/*">
        <label class="custom-file-label" for="cover_image">{% if event.cover_image_url %}Choose new image{% else %}Choose image (optional){% endif %}</label>
      </div>
      <small class="form-text text-muted">Upload a poster or cover image for your event. Supported formats: PNG, JPG, JPEG, GIF, WebP (max 16MB)</small>
    </div>
    
    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="date">Date</label>
        <input type="date" class="form-control" id="date" name="date" value="{{ event.start_date.strftime('%Y-%m-%d') }}" required>
      </div>
      <div class="form-group col-md-4">
        <label for="time">Start Time</label>
        <input type="time" class="form-control" id="time" name="time" value="{{ event.start_date.strftime('%H:%M') }}" required>
      </div>
      <div class="form-group col-md-4">
        <label for="end_time">End Time</label>
        <input type="time" class="form-control" id="end_time" name="end_time" value="{{ event.end_date.strftime('%H:%M') if event.end_date }}">
        <small class="form-text text-muted">Optional. Leave blank for no end time.</small>
      </div>
    </div>
    
    <div class="form-group">
      <label for="location">Location</label>
      <input type="text" class="form-control" id="location" name="location" value="{{ event.location }}" required placeholder="Enter event location">
    </div>
    
    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="capacity">Capacity</label>
        <input type="number" class="form-control" id="capacity" name="capacity" min="1" value="{{ event.capacity }}" required placeholder="Maximum attendees">
      </div>
      <div class="form-group col-md-4">
        <label for="price">Price ({{ get_currency_info(default_country).code }})</label>
        <input type="number" class="form-control" id="price" name="price" min="0" step="0.01" value="{{ event.price }}" placeholder="0.00">
        <small class="form-text text-muted">Price in {{ get_currency_info(default_country).code }} ({{ get_currency_info(default_country).symbol }})</small>
        <small class="form-text text-muted">Enter 0 for free events.</small>
      </div>
      <div class="form-group col-md-4">
        <label for="rsvp_deadline">RSVP Deadline</label>
        <input type="datetime-local" class="form-control" id="rsvp_deadline" name="rsvp_deadline" value="{{ event.rsvp_deadline.strftime('%Y-%m-%dT%H:%M') if event.rsvp_deadline }}">
        <small class="form-text text-muted">Leave blank for no deadline.</small>
      </div>
    </div>
    
    <!-- Event Settings -->
    <div class="form-group">
      <h5><i class="fas fa-cog mr-2"></i>Event Settings</h5>
      <div class="form-check">
        <input type="checkbox" class="form-check-input" id="feedback_enabled" name="feedback_enabled" {% if event.feedback_enabled %}checked{% endif %}>
        <label class="form-check-label" for="feedback_enabled">
          <i class="fas fa-star mr-1"></i>Enable Feedback Collection
        </label>
        <small class="form-text text-muted">Allow attendees to provide feedback after the event. This will add feedback buttons to notifications.</small>
      </div>
    </div>
    
    <div class="text-center">
      <button type="submit" class="btn btn-primary btn-lg">
        <i class="fas fa-save mr-2"></i>Update Event
      </button>
    </div>
  </form>

  <!-- Cancel Event Modal -->
  <div class="modal fade" id="cancelEventModal" tabindex="-1" role="dialog" aria-labelledby="cancelEventModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelEventModalLabel">Cancel Event</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to cancel the event <strong>"{{ event.name }}"</strong>?</p>
          <p class="text-warning">
            <i class="fas fa-exclamation-triangle"></i>
            This action cannot be undone. All attendees will be notified of the cancellation.
          </p>
          <div class="alert alert-info">
            <strong>Event Details:</strong><br>
            Date: {{ event.start_date.strftime('%Y-%m-%d %H:%M') }}<br>
            Location: {{ event.location }}<br>
            Attendees: {{ event.accepted_count }}{% if event.capacity %} / {{ event.capacity }}{% endif %}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Keep Event</button>
          <form method="post" action="{{ url_for('cancel_event', event_id=event.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-danger">
              <i class="fas fa-times mr-1"></i>Yes, Cancel Event
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}