{% extends 'base.html' %}
{% block title %}Past Events - EventApp{% endblock %}
{% block content %}
  <div class="welcome-section">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="welcome-title">Past Events</h1>
        <p class="welcome-subtitle">Your event history</p>
      </div>
      {% if current_user.is_admin %}
        <a href="{{ url_for('create_event') }}" class="btn btn-primary">
          <i class="fas fa-plus mr-2"></i>Create Event
        </a>
      {% endif %}
    </div>
  </div>
  
  {% if events %}
    <div class="row">
      {% for event in events %}
        <div class="col-12 mb-3">
          <div class="event-card">
            <!-- Status Badge -->
            {% if current_user.id == event.creator_id %}
              <div class="status-badge">Organized</div>
            {% else %}
              <div class="status-badge">Attended</div>
            {% endif %}
            
            <!-- Event Title -->
            <h5 class="event-title">{{ event.name }}</h5>
            
            <!-- Event Description -->
            {% if event.description %}
              <p class="event-description">{{ event.description[:100] }}{% if event.description|length > 100 %}â€¦{% endif %}</p>
            {% endif %}
            
            <!-- Event Meta Information -->
            <div class="event-meta">
              <i class="fas fa-calendar"></i>
              <span>{{ event.start_date.strftime('%m/%d/%Y') }}</span>
            </div>
            
            <div class="event-meta">
              <i class="fas fa-clock"></i>
              <span>{{ event.start_date.strftime('%I:%M:%S %p') }}{% if event.end_date %} - {{ event.end_date.strftime('%I:%M:%S %p') }}{% endif %}</span>
            </div>
            
            <div class="event-meta">
              <i class="fas fa-map-marker-alt"></i>
              <span>{{ event.city or event.location }}</span>
            </div>
            
            <!-- Organizer Info -->
            <div class="organizer-info">
              <div class="organizer-avatar">
                {{ event.creator.username[:2].upper() }}
              </div>
              <span>Organized by {{ event.creator.display_name }}</span>
            </div>
            
            <!-- Event Stats -->
            <div class="attendee-count">
              <i class="fas fa-users"></i>
              <span>Attendees: {{ event.accepted_count }}{% if event.capacity %} / {{ event.capacity }}{% endif %}</span>
            </div>
            
            <div class="attendee-count">
              <i class="fas fa-check-circle"></i>
              <span>Check-ins: {{ event.rsvps|selectattr('checked_in')|list|length }}</span>
            </div>
            
            <!-- Action Buttons -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div>
                <a href="{{ url_for('event_detail', event_id=event.id) }}" class="btn btn-sm btn-primary mr-2">View</a>
                {% if current_user.id == event.creator_id or current_user.is_admin %}
                  <a href="{{ url_for('event_attendees', event_id=event.id) }}" class="btn btn-sm btn-secondary mr-2">Attendees</a>
                  <a href="{{ url_for('export_attendees', event_id=event.id) }}" class="btn btn-sm btn-success">Export</a>
                {% endif %}
              </div>
              <small class="text-muted">
                {% if current_user.id == event.creator_id %}
                  You organized this
                {% else %}
                  You attended this
                {% endif %}
              </small>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-5">
      <h4>No past events</h4>
      <p class="text-muted">Your past events will appear here.</p>
    </div>
  {% endif %}
{% endblock %}